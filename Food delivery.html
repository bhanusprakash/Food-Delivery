<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>QuickBite — Food Delivery</title>
  <style>
    /* ---------- Basic reset & layout ---------- */
    :root{--accent:#ff5a3c;--muted:#666}
    *{box-sizing:border-box}
    body{font-family:Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#fafafa;color:#111}
    header{background:linear-gradient(90deg,#fff 0,#fff 60%, rgba(255,90,60,0.06));padding:18px 24px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #eee}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    main{display:grid;grid-template-columns:1fr 360px;gap:20px;padding:24px;max-width:1100px;margin:24px auto}

    /* ---------- Menu / cards ---------- */
    .menu{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:white;border-radius:12px;padding:12px;border:1px solid #eee;box-shadow:0 6px 18px rgba(12,12,12,0.03);display:flex;flex-direction:column;gap:8px}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .card h4{margin:0;font-size:16px}
    .card .desc{font-size:13px;color:var(--muted)}
    .card .bottom{display:flex;justify-content:space-between;align-items:center;margin-top:auto}
    button.add{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}

    /* ---------- Cart ---------- */
    aside.cart{position:sticky;top:20px;background:white;border-radius:12px;padding:16px;border:1px solid #eee;box-shadow:0 6px 18px rgba(12,12,12,0.03)}
    .cart h3{margin-top:0}
    .cart-list{max-height:360px;overflow:auto;margin-bottom:12px}
    .cart-item{display:flex;gap:12px;align-items:center;border-bottom:1px dashed #f0f0f0;padding:8px 0}
    .qty{display:inline-flex;gap:6px;align-items:center}
    .btn{border:1px solid #ddd;padding:6px 8px;border-radius:6px;background:white;cursor:pointer}
    .pay{width:100%;background:linear-gradient(90deg,var(--accent),#ff8b6b);color:white;border:0;padding:10px;border-radius:10px;font-weight:600;cursor:pointer}

    /* ---------- Small screens ---------- */
    @media (max-width:880px){main{grid-template-columns:1fr;padding:12px}aside.cart{position:static;margin-top:12px}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">QB</div>
      <div>
        <div style="font-weight:700">QuickBite</div>
        <div style="font-size:12px;color:var(--muted)">Delivering happiness near you</div>
      </div>
    </div>
    <div>
      <input id="search" placeholder="Search food..." style="padding:8px 12px;border-radius:10px;border:1px solid #eee;" />
    </div>
  </header>

  <main>
    <section>
      <h2>Popular near you</h2>
      <div class="menu" id="menu"></div>
    </section>

    <aside class="cart">
      <h3>Your Cart</h3>
      <div class="cart-list" id="cartList"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><strong>Total:</strong></div>
        <div id="totalAmt">₹0.00</div>
      </div>
      <input id="customerName" placeholder="Your name" style="width:100%;padding:8px;margin-bottom:8px;border-radius:8px;border:1px solid #eee" />
      <button class="pay" id="payBtn">Pay (Simulate)</button>
      <div style="font-size:12px;color:var(--muted);margin-top:8px">Payment simulated using a <strong>BankServer singleton</strong>.</div>
    </aside>
  </main>

  <script>
    /* ======================= Sample data ======================= */
    const PRODUCTS = [
      {id:1,name:'Margherita Pizza',price:249,desc:'Classic cheese & tomato',img:'https://images.unsplash.com/photo-1601924638867-3ec9b1a7c88f?auto=format&fit=crop&w=800&q=60'},
      {id:2,name:'Paneer Butter Masala',price:199,desc:'Creamy spiced paneer',img:'https://images.unsplash.com/photo-1604908177073-2b9a0b7d1f86?auto=format&fit=crop&w=800&q=60'},
      {id:3,name:'Veg Biryani',price:179,desc:'Aromatic basmati rice',img:'https://images.unsplash.com/photo-1604908177522-11c7f79b2a6d?auto=format&fit=crop&w=800&q=60'},
      {id:4,name:'Chocolate Brownie',price:99,desc:'Rich fudgy brownie',img:'https://images.unsplash.com/photo-1606312611413-98b7aef0f7b8?auto=format&fit=crop&w=800&q=60'},
      {id:5,name:'Caesar Salad',price:129,desc:'Crisp lettuce with dressing',img:'https://images.unsplash.com/photo-1572449043418-4061b7b7d7d9?auto=format&fit=crop&w=800&q=60'}
    ];

    /* ======================= BankServer Singleton ======================= */
    // We'll make the constructor effectively private using a Symbol secret.
    const BankServer = (function(){
      const SECRET = Symbol('secret_instance_key');
      const INSTANCES = new WeakMap(); // not strictly necessary but keeps instance private per class

      class BankServerClass {
        constructor(secret){
          if(secret !== SECRET) throw new Error('BankServer constructor is private. Use BankServer.getInstance()');
          this._transactions = [];
          this._balance = 10000; // starting balance for simulation (merchant account)
        }

        static getInstance(){
          if(!this.__instance__){
            this.__instance__ = new BankServerClass(SECRET);
          }
          return this.__instance__;
        }

        deposit(amount, meta={}){
          if(amount <= 0) throw new Error('Invalid deposit amount');
          this._balance += amount;
          const t = {type:'deposit',amount,meta,date:new Date().toISOString()};
          this._transactions.push(t);
          return t;
        }

        withdraw(amount, meta={}){
          if(amount <= 0) throw new Error('Invalid withdraw amount');
          if(amount > this._balance) return {ok:false,error:'Insufficient funds'};
          this._balance -= amount;
          const t = {type:'withdraw',amount,meta,date:new Date().toISOString()};
          this._transactions.push(t);
          return {ok:true,tx:t};
        }

        getBalance(){ return this._balance }
        getTransactions(){ return this._transactions.slice() }
      }

      return BankServerClass;
    })();

    /* ======================= Cart Logic ======================= */
    const state = {cart:[]};

    function renderMenu(list){
      const el = document.getElementById('menu'); el.innerHTML = '';
      list.forEach(p=>{
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `\
          <img src="${p.img}" alt="${p.name}">\
          <h4>${p.name}</h4>\
          <div class="desc">${p.desc}</div>\
          <div class="bottom">\
            <div>₹${p.price.toFixed(2)}</div>\
            <button class="add" data-id="${p.id}">Add</button>\
          </div>`;
        el.appendChild(card);
      });
    }

    function addToCart(id){
      const prod = PRODUCTS.find(p=>p.id===id); if(!prod) return;
      const found = state.cart.find(i=>i.id===id);
      if(found) found.qty++;
      else state.cart.push({id:prod.id,name:prod.name,price:prod.price,qty:1});
      renderCart();
    }

    function renderCart(){
      const list = document.getElementById('cartList'); list.innerHTML='';
      let total = 0;
      state.cart.forEach(item=>{
        total += item.price * item.qty;
        const div = document.createElement('div'); div.className='cart-item';
        div.innerHTML = `\
          <div style="flex:1">\
            <div style="font-weight:600">${item.name}</div>\
            <div style="font-size:13px;color:var(--muted)">₹${item.price.toFixed(2)} each</div>\
          </div>\
          <div class="qty">\
            <button class="btn dec" data-id="${item.id}">-</button>\
            <div style="min-width:20px;text-align:center">${item.qty}</div>\
            <button class="btn inc" data-id="${item.id}">+</button>\
          </div>`;
        list.appendChild(div);
      });
      document.getElementById('totalAmt').textContent = `₹${total.toFixed(2)}`;
    }

    // Delegated listeners
    document.addEventListener('click', e=>{
      if(e.target.matches('button.add')) addToCart(+e.target.dataset.id);
      if(e.target.matches('.dec')){
        const id=+e.target.dataset.id; const it = state.cart.find(x=>x.id===id); if(!it) return; it.qty--; if(it.qty<=0) state.cart = state.cart.filter(x=>x.id!==id); renderCart();
      }
      if(e.target.matches('.inc')){ const id=+e.target.dataset.id; const it = state.cart.find(x=>x.id===id); if(it){ it.qty++; renderCart(); } }
    });

    // Simple search
    document.getElementById('search').addEventListener('input', e=>{
      const q = e.target.value.trim().toLowerCase();
      renderMenu(PRODUCTS.filter(p=>p.name.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q)));
    });

    // Pay button simulates transaction with BankServer singleton
    document.getElementById('payBtn').addEventListener('click', ()=>{
      const name = document.getElementById('customerName').value.trim();
      if(!name) return alert('Please enter your name');
      if(state.cart.length===0) return alert('Cart is empty');

      const amount = state.cart.reduce((s,i)=>s + i.price * i.qty,0);
      const bank = BankServer.getInstance();

      // We'll simulate: customer pays and merchant receives a deposit
      try {
        const tx = bank.deposit(amount, {customer:name,items:state.cart.slice()});
        alert('Payment successful!\nAmount: ₹' + amount.toFixed(2) + '\nTx type: ' + tx.type );
        // Clear cart
        state.cart = [];
        renderCart();
      } catch(err){
        alert('Payment failed: ' + err.message);
      }

    });

    // initial render
    renderMenu(PRODUCTS);
    renderCart();

    // Expose BankServer for debugging in console (optional)
    window.BankServer = BankServer;
  </script>
</body>
</html>
